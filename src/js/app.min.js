p5.disableFriendlyErrors=!0;const N_PARTICLES=100,MAX_DISTANCE=1e4,FORCE_DIST=5e3,SPN_DIST=2e3,CON_DIST=500,G=.0667,FOURTHIRDS=4/3,SPHERE_RATIO=4/3*Math.PI,TRAIL_LENGTH=10;function RGBA(r,g,b,a){let str="rgba(";return str+=r+",",str+=g+",",str+=b+",",str+=a+")",str}function weightedRandom(min,max){return min-1+Math.round(max/(Math.random()*max+min))}function line3D(vector1,vector2,color,width){strokeWeight(width),stroke(color),line(vector1.x,vector1.y,vector1.z,vector2.x,vector2.y,vector2.z)}class Trail{constructor(pos,width){this.position=pos,this.trail=[],this.previous=new p5.Vector,this.current=new p5.Vector,this.strength,this.width=width}drawTrail(){this.previous.set(this.position);for(let i=0;i<this.trail.length;i++)this.strength=(this.trail.length-i+5)/this.trail.length,this.current.set(this.trail[i]),line3D(this.previous,this.current,RGBA(80,80,255,this.strength),this.width*this.strength),this.previous.set(this.current)}addTrail(){let v=new p5.Vector;v.set(this.position),this.trail.unshift(v),this.trail.length>10&&this.trail.pop()}updateTrail(){this.addTrail(),this.drawTrail()}}class Particle{static id_count;constructor(pos,vel,color,r=weightedRandom(1,25)){this.position=pos,this.velocity=vel,this.acceleration=new p5.Vector,this.force=new p5.Vector,this.forceTemp=new p5.Vector,this.forceTemp.limit(10),this.radius=r,this.mass=SPHERE_RATIO*r*r*r,this.id=this.id_count++,this.color=color,this.trail=new Trail(this.position,this.radius/2)}drawParticle(){push(),noStroke(),fill(this.color),translate(this.position.x,this.position.y,this.position.z),sphere(this.radius),pop()}update(nr){this.moveParticle(),this.drawParticle(),this.trail.updateTrail()}moveParticle(){Math.abs(this.position.x)>=1e4&&(this.velocity.x*=-1),Math.abs(this.position.y)>=1e4&&(this.velocity.y*=-1),Math.abs(this.position.z)>=1e4&&(this.velocity.z*=-1),this.acceleration=new p5.Vector.div(this.force,this.mass),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.force.set(0,0,0)}applyForce(particles){particles.forEach(element=>{if(this.id==element.id)return;let dis=p5.Vector.dist(this.position,element.position);if(dis<5e3){if(dis<this.radius+element.radius)return;this.forceTemp.set(0,0,0),this.forceTemp.add(this.position),this.forceTemp.sub(element.position),this.forceTemp.normalize();let strength=G*this.mass*element.mass/(dis*dis);this.forceTemp.mult(strength),element.force.add(this.forceTemp)}})}}class starParticle extends Particle{constructor(pos,vel,color,r){super(pos,vel,color,r)}update(nr){super.moveParticle(),super.drawParticle()}}class Constellation{constructor(){this.particles=[],this.updates=0}addParticles(){for(let i=0;i<100;i++){var r=Math.round(random(120,220)),g=Math.round(random(140,190)),b=Math.round(random(140,190)),pos=this.createRandomVector(2e3),vel=new p5.Vector(random(-.8,.8),random(-.8,.8),random(-.8,.8)),color=RGBA(r,g,b,1);this.particles.push(new Particle(pos,vel,color))}}addCenterParticle(){var pos=this.createRandomVector(1e3),vel=new p5.Vector,color=RGBA(255,240,180,1),radius=50;this.particles.push(new starParticle(pos,vel,color,50))}updateParticles(){this.updates++;for(let i=0;i<this.particles.length;i++)this.particles[i].applyForce(this.particles);for(let i=0;i<this.particles.length;i++)this.particles[i].update(this.updates)}createRandomVector(range){let x=random(-range,range),y=random(-range,range),z=random(-range,range);return new p5.Vector(x,y,z)}}const constellation=new Constellation;let panvalue=1,prevpan=1,tiltvalue=1,prevtilt=1,updateCam=!1,cam,pos=-500,x,y;function updateMouse(){if(updateCam){var pan=(mouseX-width/2)/width/2,tilt=(mouseY-height/2)/height/2;panvalue=Math.abs(pan)>.05?pan:0,tiltvalue=Math.abs(tilt)>.05?tilt:0,panvalue!=prevpan&&(prevpan=panvalue),tiltvalue!=prevtilt&&(prevtilt=tiltvalue),cam.pan(.05*-panvalue),cam.tilt(.05*tiltvalue)}}function mousePressed(){updateCam=!0}function mouseReleased(){updateCam=!1}function mouseWheel(event){pos+=event.delta}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function setup(){colorMode(RGB),frameRate(30);let interval=1/frameRate();const renderer=createCanvas(windowWidth,windowHeight,WEBGL);renderer.canvas.style.display="block",cam=createCamera(),constellation.addParticles(),constellation.addCenterParticle(),x=-width/2,y=-height/2}function updateKeyboard(){keyIsDown(65)&&(x+=5),keyIsDown(68)&&(x-=5),keyIsDown(87)&&(y+=5),keyIsDown(83)&&(y-=5)}function draw(){updateKeyboard(),updateMouse(),translate(x,y,pos),background("#020202"),constellation.updateParticles()}