p5.disableFriendlyErrors=!0;const N_PARTICLES=50,MAX_DISTANCE=1e4,FORCE_DIST=5e3,SPN_DIST=5e3,G=.667,FOURTHIRDS=4/3,SPHERE_RATIO=4/3*Math.PI,TRAIL_LENGTH=20,TRAIL_SPACING=400,START_SPEED=5,MIN_PLANET_RAD=3,MAX_PLANET_RAD=20,CAM_START_POS=-3e3,SPHERE_SEGS=16;function RGBA(r,g,b,a){let str="rgba(";return str+=r+",",str+=g+",",str+=b+",",str+=a+")",str}function weightedRandom(min,max){return min-1+Math.round(max/(Math.random()*max+min))}function line3D(vector1,vector2,color,width){push(),strokeWeight(width),stroke(color),beginShape(LINES),vertex(vector1.x,vector1.y,vector1.z),vertex(vector2.x,vector2.y,vector2.z),endShape(),pop()}class Trail{constructor(pos,width){this.updates=0,this.position=pos,this.width=width,this.trail=[],this.previous=new p5.Vector,this.current=new p5.Vector,this.index=0,this.length=20,this.spacing=400,this.colors=[],this.widths=[];for(let i=0;i<this.length;i++){this.trail.push((new p5.Vector).set(pos));let strength=(this.length-i)/this.length+.2;this.widths.push(this.width*strength),this.colors.push(RGBA(130,140,255,strength))}}drawTrail(){let n,revolution=this.length+this.index-1;this.previous.set(this.position);for(let i=0;i<this.length;i++)n=(revolution-i)%this.length,this.current.set(this.trail[n]),line3D(this.previous,this.current,this.colors[i],this.widths[i]),this.previous.set(this.current)}addSegment(){this.trail[this.index].set(this.position),this.index=(this.index+1)%this.length}updateTrail(draw){let angle=Math.abs(this.previous.angleBetween(this.position)),delta=p5.Vector.dist(this.previous,this.position);(angle>1||delta>this.spacing)&&this.addSegment(),draw&&this.drawTrail()}}class Particle{static id_count;constructor(pos,vel,color,r){this.position=pos,this.velocity=vel,this.acceleration=new p5.Vector,this.force=new p5.Vector,this.forceTemp=new p5.Vector,this.forceTemp.limit(10),this.radius=r,this.mass=SPHERE_RATIO*r*r*r,this.id=this.id_count++,this.color=color,this.trail=new Trail(this.position,this.radius/2)}drawParticle(){push(),noStroke(),fill(this.color),translate(this.position.x,this.position.y,this.position.z),sphere(this.radius,16,16),pop()}update(seconds){this.moveParticle(),this.drawParticle(),this.acceleration.mag()>.1?this.trail.updateTrail(!0):this.trail.updateTrail(!1)}moveParticle(seconds){Math.abs(this.position.x)>=1e4&&(this.velocity.x*=-1),Math.abs(this.position.y)>=1e4&&(this.velocity.y*=-1),Math.abs(this.position.z)>=1e4&&(this.velocity.z*=-1),this.acceleration=new p5.Vector.div(this.force,this.mass).mult(seconds),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.force.set(0,0,0)}applyForce(particles){particles.forEach(element=>{if(this.id==element.id)return;let dis=p5.Vector.dist(this.position,element.position);if(dis<5e3){if(dis<this.radius+element.radius)return;this.forceTemp.set(0,0,0),this.forceTemp.add(this.position),this.forceTemp.sub(element.position),this.forceTemp.normalize();let strength=G*this.mass*element.mass/(dis*dis);this.forceTemp.mult(strength),element.force.add(this.forceTemp)}})}}class starParticle extends Particle{constructor(pos,vel,color,r){super(pos,vel,color,r)}update(seconds){super.moveParticle(seconds),super.drawParticle()}}class Constellation{constructor(n){this.num_particles=n,this.particles=[]}addParticles(){for(let i=0;i<this.num_particles;i++){var rad=weightedRandom(3,20),r=Math.round(random(120,220)),g=Math.round(random(140,190)),b=Math.round(random(140,190)),pos=this.createRandomVector(5e3),vel=this.createRandomVector(5),color=RGBA(r,g,b,1);this.particles.push(new Particle(pos,vel,color,rad))}}addCenterParticle(){var pos=this.createRandomVector(500),vel=new p5.Vector,color=RGBA(255,255,230,1),radius=50;this.particles.push(new starParticle(pos,vel,color,50))}updateParticles(seconds){let length=this.particles.length;for(let i=0;i<length;i++)this.particles[i].applyForce(this.particles);for(let i=0;i<length;i++)this.particles[i].update(seconds)}createRandomVector(range){let x=random(-range,range),y=random(-range,range),z=random(-range,range);return new p5.Vector(x,y,z)}}class userCamera{constructor(w,h){this.panvalue=1,this.prevpan=1,this.tiltvalue=1,this.prevtilt=1,this.PanTiltActive=!1,this.x=-w/2,this.y=-h/2,this.z=-3e3,this.cam=createCamera()}updatePanTilt(pan,tilt){!1!==this.PanTiltActive&&(Math.abs(pan)>.05?this.panvalue=pan:this.panvalue=0,Math.abs(tilt)>.05?this.tiltvalue=tilt:this.tiltvalue=0,this.panvalue!=this.prevpan&&(this.prevpan=this.panvalue),this.tiltvalue!=this.prevtilt&&(this.prevtilt=this.tiltvalue),this.cam.pan(.05*-this.panvalue),this.cam.tilt(.05*this.tiltvalue))}updatePosX(amount){this.x+=amount}updatePosY(amount){this.y+=amount}updatePosZ(amount){this.z+=amount}updateCamera(){translate(this.x,this.y,this.z)}enablePanTilt(){this.PanTiltActive=!0}disablePanTilt(){this.PanTiltActive=!1}}let constellation,userCam;function updateMouse(){var pan=(mouseX-width/2)/width/2,tilt=(mouseY-height/2)/height/2;userCam.updatePanTilt(pan,tilt)}function mousePressed(){userCam.enablePanTilt()}function mouseReleased(){userCam.disablePanTilt()}function mouseWheel(event){userCam.updatePosZ(event.delta)}function windowResized(){resizeCanvas(windowWidth,windowHeight)}function updateKeyboard(){keyIsDown(65)&&userCam.updatePosX(5),keyIsDown(68)&&userCam.updatePosX(-5),keyIsDown(87)&&userCam.updatePosY(5),keyIsDown(83)&&userCam.updatePosY(-5)}function setup(){colorMode(RGB),frameRate(60);const renderer=createCanvas(windowWidth,windowHeight,WEBGL);renderer.canvas.style.display="block",userCam=new userCamera(width,height),constellation=new Constellation(50),constellation.addParticles(),constellation.addCenterParticle()}function draw(){let fps=frameRate(),sec=1/Math.max(fps,1);updateKeyboard(),updateMouse(),userCam.updateCamera(),background("#020202"),constellation.updateParticles(sec)}